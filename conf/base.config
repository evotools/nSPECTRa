
process {   
    cpus = 1   
    memory = '2G'   
    errorStrategy = { task.attempt <= 2 ? "retry" : "ignore" }   
    maxRetries = 2 
    maxErrors = '-1'
  
    withLabel: small{
      cpus = 1
      memory = { 2.GB * task.attempt }
      time = {4.h * task.attempt }
    }
    withLabel: medium{
      cpus = 1
      memory = { 4.GB * task.attempt }
      time = { 8.h * task.attempt }
    }
    withLabel: medium_mem{
      cpus = 1
      memory = { 12.GB * task.attempt }
      time = { 12.h * task.attempt }
      clusterOptions = { "-P roslin_ctlgh -l h_vmem=${task.memory.toString().replaceAll(/[\sB]/,'')}" }
    }
    withLabel: medium_multi{
      cpus = 2
      memory = { 4.GB * task.attempt }
      time = { 12.h * task.attempt }
      clusterOptions = { "-P roslin_ctlgh -l h_vmem=${task.memory.toString().replaceAll(/[\sB]/,'')}" }
    }
    withLabel: large{
      cpus = 2
      memory = { 4.GB * task.attempt }
      time = { 12.h * task.attempt }
    }
    withLabel: large_smallmem{
      cpus = 8
      memory = { 2.GB * task.attempt }
      time = { 47.h * task.attempt }
    }
    withLabel: large_largemem{
      cpus = 8
      memory = { 8.GB * task.attempt }
      time = { 23.h * task.attempt }
    }
    withLabel: largemem{
      cpus = 1
      memory = { 12.GB * task.attempt }
      time = { 96.h * task.attempt }
    }
    withLabel: compile{
      cpus = 4
      memory = { 4.GB * task.attempt }
      time = {4.h * task.attempt }
    }
    withLabel: vep{
      conda = "$baseDir/envs/vep-environment.yml" 
      cpus = 4
      memory = { 4.GB * task.attempt }
      time = { 12.h * task.attempt }
    }
    withLabel: renv{
      conda = "$baseDir/envs/r-environment.yml" 
      cpus = 1
      memory = { 4.GB * task.attempt }
      time = { 23.h * task.attempt }
    }
    withLabel: renv_multi{
      conda = "$baseDir/envs/r-environment.yml" 
      cpus = 1
      memory = { 4.GB * task.attempt }
      time = { 1.h * task.attempt }
    }
    withLabel: renv_large{
      conda = "$baseDir/envs/r-environment.yml" 
      cpus = 1
      memory = { 32.GB * task.attempt }
      time = { 23.h * task.attempt }
    }
    withName: sdm{
      conda = "$baseDir/envs/sdm-environment.yml" 
      cpus = 1
      memory = { 4.GB * task.attempt }
      time = {8.h * task.attempt }
    }
}
